{% extends 'dashboard/base_dashboard.html' %}
{% load static dashboard_tags %}


{% block title %}
    Utilisateur | Page de garde | {{ block.super }}
{% endblock title %}

{% block stylesheets %}

    {{ block.super }}

    <link href="{% static 'dashboard/css/plugins/summernote/summernote-bs4.css' %}" rel="stylesheet">


{% endblock stylesheets %}


{% block content %}

    <div class="wrapper wrapper-content animated fadeInRight">

        <div class="row">
            <div class="col-lg-12">

                <div class=" float-left">
                    <a href="{% url 'dashboard:users_list' %}">
                        <button class="btn btn-primary dim">
                            <i class="fa fa-arrow-left"></i> Liste des utilisateurs
                        </button>
                    </a>
                </div>

                <div class=" float-right">
                    <a href="{% url 'dashboard:delete_user' id_user=profil.id %}">
                        <button id="btn_lancer_compagne" class="btn btn-danger dim">
                            <i class="fa fa-trash"></i> Supprimer
                        </button>
                    </a>

                    <a href="{% url 'dashboard:update_user' id_user=profil.id %}">

                        <button class="btn btn-success dim"><i class="fa fa-pencil"></i> Modifier</button>
                    </a>

                </div>
            </div>

        </div>


        <div class="row">

            <div class="col-lg-4">
                <div class="widget style1 navy-bg">
                    <div class="row">
                        <div class="col-4">
                            <i class="fa fa-envelope fa-5x"></i>
                        </div>
                        <div class="col-8 text-right">
                            <span>Followers</span>
                            <h2 class="font-bold">{{ followers }}</h2>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="widget style1 navy-bg">
                    <div class="row">
                        <div class="col-4">
                            <i class="fa fa-paper-plane fa-5x"></i>
                        </div>
                        <div class="col-8 text-right">
                            <span> Posts crées </span>
                            <h2 class="font-bold">{{ profil.statut_set.all.count }}</h2>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="widget style1 navy-bg">
                    <div class="row">
                        <div class="col-4">
                            <i class="fa fa-check fa-5x"></i>
                        </div>
                        <div class="col-8 text-right">
                            <span>Produits en vente </span>
                            <h2 class="font-bold">{{ profil.shop.product_set.all.count|default:"0" }}</h2>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="widget style1 navy-bg">
                    <div class="row">
                        <div class="col-4">
                            <i class="fa fa-envelope-open fa-5x"></i>
                        </div>
                        <div class="col-8 text-right">
                            <span>Commandes passées</span>
                            <h2 class="font-bold">{{ profil.order_set.all.count }}</h2>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="widget style1 navy-bg">
                    <div class="row">
                        <div class="col-4">
                            <i class="fa fa-question-circle-o fa-5x"></i>
                        </div>
                        <div class="col-8 text-right">
                            <span>Questions posées</span>
                            <h2 class="font-bold">{{ profil.question_set.all.count }}</h2>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="widget style1 navy-bg">
                    <div class="row">
                        <div class="col-4">
                            <i class="fa fa-commenting fa-5x"></i>
                        </div>
                        <div class="col-8 text-right">
                            <span>Réponses postés</span>
                            <h2 class="font-bold">{{ profil.answer_set.all.count }}</h2>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-6">
                <div class="widget style1 bg-success">
                    <div class="row">
                        <div class="col-4">
                            <i class="fa fa-bullhorn fa-5x"></i>
                        </div>
                        <div class="col-8 text-right">
                            <span>Appels d'offres</span>
                            <h2 class="font-bold">{{ profil.ao_set.all.count }}</h2>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-6">
                <div class="widget style1 bg-purple">
                    <div class="row">
                        <div class="col-4">
                            <i class="fa fa-briefcase fa-5x"></i>
                        </div>
                        <div class="col-8 text-right">
                            <span>Lots</span>
                            <h2 class="font-bold">{{ profil.count_lots }}</h2>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="row m-b-lg m-t-lg">
            <div class="col-md-12">

                <div class="profile-image">
                    <img src="{% if profil.photo_profil %} {{ profil.photo_profil.image.url }} {% else %} {% static 'dashboard/img/default_profil_m.png' %} {% endif %}"
                         class="rounded-circle circle-border m-b-md"
                         alt="profile">
                </div>
                <div class="profile-info">
                    <div class="">
                        <div>
                            <h2 class="no-margins">
                                {{ profil.user.first_name | title }} {{ profil.user.last_name | title }}
                                | {{ profil.type }}
                            </h2>
                            <h4>{{ profil.user.email }}</h4>
                            <h5>{{ profil.fonction }}</h5>
                            <p>Crée le : {{ profil.user.date_joined }}</p>
                            {% if profil.resume %}<small> {{ profil.resume }}  </small>{% endif %}
                            <h5 style="margin-top:15px;">
                                {% if exist_newsletter %}
                                    <i class="fa fa-check fa-icon-checked" style="color:#1ab394;"></i>
                                {% else %}
                                    <i class="fa fa-times fa-icon-not-checked"></i>
                                {% endif %} Abonné newsletter &nbsp;&nbsp;&nbsp;



                                {% if profil.user.is_active %}
                                    <i class="fa fa-check fa-icon-checked" style="color:#1ab394;"></i>
                                {% else %} <i class="fa fa-times fa-icon-not-checked"></i>
                                {% endif %} Verifié &nbsp;&nbsp;&nbsp;


                                {% if profil.is_active_professional %}
                                    <i class="fa fa-check fa-icon-checked" style="color:#1ab394;"></i>
                                {% else %}
                                    <i class="fa fa-times fa-icon-not-checked"></i>
                                {% endif %}  Activé </h5>
                        </div>
                    </div>
                </div>
            </div>


        </div>
        <div class="row">

            <div class="col-lg-6 mar-b-30">

                <div class="list-group">
                    <a href="#" class="list-group-item list-group-item-action active disabled">
                        A propos
                    </a>

                    <span
                            class="list-group-item list-group-item-action">
                        Dernière connexion
                        : {{ profil.user.last_login | default_if_none:"Jamais" }}
                    </span>

                    <span
                            class="list-group-item list-group-item-action">
                        {{ profil.resume|default_if_none:"Aucun résumé." }}
                    </span>

                </div>
            </div>


            <div class="col-lg-6 mar-b-30">

                <div class="list-group">
                    <a href="#" class="list-group-item list-group-item-action active disabled">
                        Dernières publications
                    </a>
                    {% for publication in profil.statut_set.all.reverse|slice:"4" %}
                        <a href="{% url 'dashboard:socialmedia_infos_publication' id_publication=publication.id %}"
                           class="list-group-item list-group-item-action">
                            {{ publication.contenu_statut|truncatechars:"120" }}
                        </a>
                    {% empty %}

                        <span
                                class="list-group-item list-group-item-action">

                            Aucune publication
                        </span>
                    {% endfor %}
                </div>

            </div>

            <div class="col-lg-6 mar-b-30">

                <div class="list-group">
                    <a href="#" class="list-group-item list-group-item-action active disabled">
                        Produits achetés lors de la dernière commande
                    </a>
                    {% for orderline in profil.order_set.last.orderline_set.all.reverse|slice:"4" %}
                        <a href="{% url 'dashboard:marketplace_product' id_product=orderline.product.id %}"
                           class="list-group-item list-group-item-action">
                            {{ orderline.product.name|truncatechars:"120" }}
                        </a>
                    {% empty %}

                        <span
                                class="list-group-item list-group-item-action">

                            Aucun produit
                        </span>
                    {% endfor %}
                </div>


            </div>

            <div class="col-lg-6 mar-b-30">

                <div class="list-group">
                    <a href="#" class="list-group-item list-group-item-action active disabled">
                        Derniers produits en vente
                    </a>
                    {% for produit in profil.shop.product_set.all %}
                        <a href="{% url 'dashboard:marketplace_product' id_product=produit.id %}"
                           class="list-group-item list-group-item-action">
                            {{ produit.name  |truncatechars:"120" }}
                        </a>
                    {% empty %}
                        <span
                                class="list-group-item list-group-item-action">

                            Aucun produit
                        </span>
                    {% endfor %}
                </div>

            </div>

            <div class="col-lg-12 mar-b-30">

                <div class="list-group">
                    <a href="#" class="list-group-item list-group-item-action active disabled">
                        Derniers articles publiés
                    </a>
                    {% for article in articles %}
                        <a href="{% url 'dashboard:news_infos_article' id_article=article.id %}"
                           class="list-group-item list-group-item-action">
                            {{ article.small_title|truncatechars:"120" }}
                        </a>
                    {% empty %}
                        <span
                                class="list-group-item list-group-item-action">
                            Aucun article
                        </span>
                    {% endfor %}
                </div>

            </div>

            <div class="col-lg-6 mar-b-30">

                <div class="list-group">
                    <a href="#" class="list-group-item list-group-item-action active">
                        Dernières questions QA
                    </a>
                    {% for question in profil.question_set.all|slice:"6" %}
                        <a href="{% url 'dashboard:qa_question' id_question=question.id %}"
                           class="list-group-item list-group-item-action">
                            {{ question.title  |truncatechars:"55" }}
                        </a>
                    {% empty %}
                        <span
                                class="list-group-item list-group-item-action">

                            Aucune question
                        </span>
                    {% endfor %}
                </div>

            </div>

            <div class="col-lg-6 mar-b-30">

                <div class="list-group">
                    <a href="#" class="list-group-item list-group-item-action active">
                        Dernières réponses QA
                    </a>
                    {% for answer in profil.answer_set.all|slice:"6" %}
                        <a href="{% url 'dashboard:qa_reponse' id_reponse=answer.id %}"
                           class="list-group-item list-group-item-action">
                            {{ answer.content  |truncatechars:"55" }}
                        </a>
                    {% empty %}
                        <span
                                class="list-group-item list-group-item-action">

                            Aucune réponse
                        </span>
                    {% endfor %}
                </div>

            </div>


            <div class="col-lg-12 mar-b-30">

                <div class="list-group">
                    <a href="#" class="list-group-item list-group-item-action active disabled">
                        Derniers articles du blog Q&A
                    </a>
                    {% for article in profil.article_set.all|slice:"7" %}
                        <a href="{% url 'dashboard:qa_article' id_article=article.id %}"
                           class="list-group-item list-group-item-action">
                            {{ article.title|truncatechars:"120" }}
                        </a>
                    {% empty %}
                        <span
                                class="list-group-item list-group-item-action">
                            Aucun article
                        </span>
                    {% endfor %}
                </div>

            </div>


        </div>

    <div class="row">


            <div class="col-md-6 mar-b-30">
                <div class="list-group">
                    <a href="{% url 'dashboard:ao_appels_offres' %}"
                       class="list-group-item list-group-item-action active disabled bg-success">
                        Appels d'offres de l'entreprise <span class="pull-right">Voir tout</span>
                    </a>

                    {% for ao in profil.ao_set.all %}
                        <a href="{% url  'dashboard:ao_appel_offre' id=ao.id %}"
                           style=" color: inherit;text-decoration: inherit; "
                           class="list-group-item list-group-item-action">
                            <strong>{{ ao.title }} <i class="fa fa-calendar"></i> <span
                                    class="small-text">{{ ao.date_limit }} </span> </strong>
                        </a>
                    {% empty %}

                        <span
                                class="list-group-item list-group-item-action">
                            Aucune appel d'offres.
                        </span>
                    {% endfor %}
                </div>
            </div>


            <div class="col-md-6 mar-b-30">
                <div class="list-group">
                    <a href="{% url 'dashboard:ao_lots' %}"
                       class="list-group-item list-group-item-action active disabled bg-purple">
                        Lots de l'entreprise <span class="pull-right">Voir tout</span>
                    </a>

                    {% for lot in profil.get_lots %}
                        <a href="{% url  'dashboard:ao_lot' id=lot.id %}"
                           style=" color: inherit;text-decoration: inherit; "
                           class="list-group-item list-group-item-action">
                            <strong>{{ lot.title }} <i class="fa fa-money"></i> <span
                                    class="small-text">{{ lot.budget }} DH </span> </strong>
                        </a>
                    {% empty %}

                        <span
                                class="list-group-item list-group-item-action">
                            Aucun lot.
                        </span>
                    {% endfor %}
                </div>
            </div>

        <div class="col-md-12 mar-b-30" >
                <div class="list-group">

                    <a href="{% url 'dashboard:tracking_visites' %}?email={{ profil.user.email }}"
                       class="list-group-item list-group-item-action active disabled">
                        Derniers visites <span class="pull-right">Voir tout</span>
                    </a>

                    <table class="table table-striped table-bordered">
                        <thead>
                        <th>Page visitée</th>
                        <th>Date visite</th>
                        <th>Actions</th>
                        </thead>

                        <tbody>
                        {% for tracking in tracking_dernieres_visites %}
                            <tr>
                                <td>
                                    {% if tracking.content_object %}
                                    {{ tracking.content_object |verbose_name }}{% endif %} :
                                    {% if  tracking.content_object.tracking_get_admin_url != "" %}
                                        <a href="{{ tracking.content_object.tracking_get_admin_url }}">{% endif %}{{ tracking.content_object.tracking_get_description }}
                                    {% if tracking.content_object.tracking_get_admin_url != "" %}</a>{% endif %}
                                </td>
                                <td>{{ tracking.timestamp }}</td>
                            <td>
                                <a href="{{ tracking.content_object.tracking_get_absolute_url }}" target="_blank">
                                        <button class="btn btn-success btn-xs">Visiter</button>
                                    </a>

                                    <a href="{% url 'dashboard:tracking_visite' id_visite=tracking.id %}">
                                        <button class="btn btn-primary btn-xs">Voir plus</button>
                                    </a>
                            </td>
                            </tr>
                        {% empty %}
                            <tr>
                                <td valign="top" colspan="2" class="dataTables_empty text-center">Aucun élément à
                                    afficher
                                </td>
                            </tr>
                        {% endfor %}

                        </tbody>

                    </table>
                </div>
            </div>


        </div>

    </div>




{% endblock content %}

{% block scripts %}

    {{ block.super }}
    <script>
        $('#dashboard_page_garde').addClass("active");
        $('#page_de_garde_utilisateurs').addClass("active");
    </script>

    <!-- blueimp gallery -->
    <script src="{% static 'dashboard/js/plugins/blueimp/jquery.blueimp-gallery.min.js' %}"></script>





    <!-- Sparkline -->
    <script src="{% static 'dashboard/js/plugins/sparkline/jquery.sparkline.min.js' %}"></script>

    <script>
        $(document).ready(function () {


            $("#sparkline1").sparkline([34, 43, 43, 35, 44, 32, 44, 48], {
                type: 'line',
                width: '100%',
                height: '50',
                lineColor: '#1ab394',
                fillColor: "transparent"
            });


        });
    </script>





{% endblock scripts %}

