{% extends 'dashboard/base_dashboard.html' %}
{% load static %}


{% block title %}
    Article | Q&A | {{ block.super }}
{% endblock title %}

{% block stylesheets %}

    {{ block.super }}

    <link href="{% static 'dashboard/css/plugins/summernote/summernote-bs4.css' %}" rel="stylesheet">

    <!-- Image Gallery -->
    <link href="{% static 'dashboard/css/plugins/blueimp/css/blueimp-gallery.min.css' %}" rel="stylesheet">


    <!-- Toastr style -->
    <link href="{% static 'dashboard/css/plugins/toastr/toastr.min.css' %}" rel="stylesheet">



{% endblock stylesheets %}


{% block content %}

    <div class="wrapper wrapper-content wrapper-content-custom">


        <div class="row">
            <div class="col-lg-12">

                <div class=" float-left">
                    <a href="{% url 'dashboard:qa_articles' %}">
                        <button class="btn btn-primary dim"><i class="fa fa-arrow-left"></i> Liste de articles

                        </button>
                    </a>

                </div>

                <div class=" float-right">
                    <a href="{% url 'dashboard:qa_delete_article' id_article=article.id %}">
                        <button id="btn_lancer_compagne" class="btn btn-danger dim">
                            <i class="fa fa-trash"></i> Supprimer
                        </button>
                    </a>

                    <a href="{% url 'dashboard:qa_update_article' id_article=article.id %}">
                        <button class="btn btn-success dim"><i class="fa fa-pencil"></i> Modifier</button>
                    </a>

                </div>
            </div>

        </div>

        <div class="row">

            <div class="col-lg-12">
                <div class="widget style1 navy-bg">
                    <div class="row">
                        <div class="col-4">
                            <i class="fa fa-user-circle fa-5x"></i>
                        </div>
                        <div class="col-8 text-right">
                            <span>Auteur</span>
                            <h2 class="font-bold">{{ article.author.user.first_name.title }} {{ article.author.user.last_name.title }}</h2>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-3">
                <div class="widget style1 navy-bg">
                    <div class="row">
                        <div class="col-4">
                            <i class="fa fa-eye fa-5x"></i>
                        </div>
                        <div class="col-8 text-right">
                            <span>Vues</span>
                            <h2 class="font-bold">{{ article.views }}</h2>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-3">
                <div class="widget style1 navy-bg">
                    <div class="row">
                        <div class="col-4">
                            <i class="fa fa-thumbs-o-up fa-5x"></i>
                        </div>
                        <div class="col-8 text-right">
                            <span>Likes</span>
                            <h2 class="font-bold">{{ article.likes }}</h2>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-3">
                <div class="widget style1 navy-bg">
                    <div class="row">
                        <div class="col-4">
                            <i class="fa fa-commenting fa-5x"></i>
                        </div>
                        <div class="col-8 text-right">
                            <span>Commentaires</span>
                            <h2 class="font-bold">{{ article.comment_set.all.count }}</h2>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-3">
                <div class="widget style1 navy-bg">
                    <div class="row">
                        <div class="col-4">
                            <i class="fa fa-share fa-5x"></i>
                        </div>
                        <div class="col-8 text-right">
                            <span>Partages</span>
                            <h2 class="font-bold">{{ article.shares }}</h2>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="row justify-content-md-center">
            <div class="col-lg-11">
                <div class="ibox">
                    <div class="ibox-content">
                        <div class="float-right">
                        </div>
                        {% if signalements != 0 %}
                            <h4 class="text-center"><span class="error_msg"> <i
                                    class="fa fa-warning "></i> {{ signalements }} Signalements  <a
                                    style="display:inline;"
                                    href="{% url  'dashboard:qa_article_delete_signals' id=article.id %}"><button
                                    class="btn btn-xs btn-danger"> Retirer les signalements </button></a></span>
                            </h4>
                        {% endif %}

                        <div class="text-center article-title" style="    margin-bottom: 30px;">
                            <span class="text-muted"><i class="fa fa-clock-o"></i> {{ article.creation_date }}</span>
                            &nbsp;&nbsp;&nbsp;
                            <span class="text-muted"><i class="fa fa-eye"></i> {{ article.views }}</span>
                            &nbsp;&nbsp;&nbsp;
                            <span class="text-muted"><i
                                    class="fa fa-thumbs-o-{% if article.likes >= 0 %}up{% else %}down{% endif %}"></i> {{ article.likes }}</span>
                            &nbsp;&nbsp;&nbsp;
                            <span class="text-muted"><i class="fa fa-share"></i> {{ article.shares }}</span>

                            <h1>
                                {{ article.title }}
                            </h1>
                        </div>


                        {% if article.image %}
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="text-center" style="width:100%">
                                        <img src="{{ article.image.url }}" alt="" height="300">
                                    </div>
                                </div>
                            </div>
                            <br><br>
                        {% endif %}



                        {{ article.content | safe }}

                        <hr>
                        <div class="row">
                            <div class="col-md-6">
                                <h5>Auteur: <a
                                        href="{% url 'dashboard:user_infos' id_user=article.author.id %}"> {{ article.author.user.first_name.title }} {{ article.author.user.last_name.title }}</a>
                                </h5>
                                <h5>Catégorie:</h5>
                                <span class="badge badge-primary">{{ article.category.title }}</span>
                                <h5>Tags:</h5>
                                {% for tag in article.tags.all %}
                                    <span class="badge badge-dark">{{ tag.title }}</span>
                                {% endfor %}
                            </div>
                            <div class="col-md-6">
                                <div class="small text-right">
                                    <div><i class="fa fa-comments-o"> </i> {{ article.comment_set.all.count }}
                                        Commentaires
                                    </div>
                                </div>
                            </div>
                        </div>

                        <br>

                        <div class="row">
                            <div class="col-lg-12">

                                <h2>Commentaires:</h2>


                                {% for comment in article.comment_set.all %}

                                    <div class="social-feed-box">
                                        <div class="social-avatar">
                                            <div class="media-body">


                                                {# Signalement Commentaire #}
                                                {% if comment.id in signalements_comments_ids %}
                                                    <h4>
                                                            <span class="error_msg"> <i class="fa fa-warning "></i> Signalé
                                                            <a style="display:inline;"
                                                               href="{% url  'dashboard:qa_comment_delete_signals' id=comment.id %}"><button
                                                                    class="btn btn-xs btn-danger"> Retirer  les signalements </button></a></span>
                                                    </h4>
                                                {% endif %}


                                                {% if comment.user is not None %}
                                                    <a href="{% url 'dashboard:user_infos' id_user=comment.user.id %}"><strong>{{ comment.user.user.first_name|capfirst }} {{ comment.user.user.last_name|upper }}</strong>
                                                    </a>  {{ comment.user.user.email }}

                                                {% else %}
                                                    <strong>{{ comment.full_name }} - {{ comment.email }}</strong>
                                                {% endif %}

                                                <a style="display:inline;"
                                                   href="{% url  'dashboard:qa_delete_comment' id=comment.id %}">
                                                    <button class="btn btn-xs btn-danger"> Supprimer le commentaire
                                                    </button>
                                                </a></span>


                                                <br>
                                                <small class="text-muted">{{ comment.creation_date }}</small>
                                                &nbsp;&nbsp;
                                                <small class="text-muted"><i
                                                        class="fa fa-thumbs-o-up"></i> {{ comment.likes }}</small>
                                            </div>
                                        </div>

                                        <div class="social-body">
                                            <p>
                                                {{ comment.content }}
                                            </p>
                                        </div>


                                    </div>

                                {% endfor %}
                            </div>


                        </div>
                    </div>


                </div>
            </div>

            <div class="col-md-11 mar-b-30">
                <div class="list-group">

                    <a href="{% url 'dashboard:tracking_visites' %}?url={{ article.tracking_get_absolute_url }}"
                       class="list-group-item list-group-item-action active disabled">
                        Derniers visites <span class="pull-right">Voir tout</span>
                    </a>

                    <table class="table table-striped table-bordered">
                        <thead>
                        <th>Utilisateur</th>
                        <th>Date</th>
                        </thead>

                        <tbody>
                        {% for tracking in tracking_dernieres_visites %}
                            <tr>
                                <td>{% if not tracking.user %} Visiteur non connecté {% else %}
                                    <a href="{% url 'dashboard:user_infos' id_user=tracking.user.profil.id %}">{{ tracking.user.first_name|title }} {{ tracking.user.last_name|title }}</a>{% endif %}
                                </td>
                                <td>{{ tracking.timestamp }}</td>
                            </tr>
                        {% empty %}
                            <tr>
                                <td valign="top" colspan="2" class="dataTables_empty text-center">Aucun élément à
                                    afficher
                                </td>
                            </tr>
                        {% endfor %}

                        </tbody>

                    </table>
                </div>
            </div>

        </div>
    </div>
    </div>


{% endblock content %}

{% block scripts %}

    {{ block.super }}
    <script>
        $('#dashboard_qa').addClass("active");
        $('#qa_articles').addClass("active");
    </script>

    <!-- blueimp gallery -->
    <script src="{% static 'dashboard/js/plugins/blueimp/jquery.blueimp-gallery.min.js' %}"></script>



    <!-- Toastr script -->
    <script src="{% static 'dashboard/js/plugins/toastr/toastr.min.js' %}"></script>


    <script>
        {% if messages %}
            {% for msg in messages %}
                {% if msg.tags == "success" %}
                    toastr.options = {
                        "closeButton": true,
                        "debug": false,
                        "progressBar": true,
                        "preventDuplicates": false,
                        "positionClass": "toast-top-right",
                        "onclick": null,
                        "showDuration": "400",
                        "hideDuration": "1000",
                        "timeOut": "7000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    }


                    Command: toastr["success"]("{{ msg | safe }}")

                {% endif %}
            {% endfor %}
        {% endif %}
    </script>






{% endblock scripts %}

